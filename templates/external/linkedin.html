{% extends "includes/dashboard-base.html" %}
{% load static %}

{% block content %}
<div class="air__layout__content">
  <div class="air__utils__content">
    <div class="air__utils__heading">
      <h5>Dashboard LinkedIn</h5>
    </div>
    <div class="card">
      <div class="card-body">
        <h4 class="mb-4">
          <strong>Tabel Data LinkedIn</strong>
        </h4>
        <div class="row">
          <div class="col-lg-12">
            <div class="mb-5">
              <table class="table table-hover nowrap" id="example1">
                <thead>
                  <tr>
                    <th>Post Username</th>
                    <th>Post Job Tittle</th>
                    <th>Post Description</th>
                    <th>Post Time</th>
                    <th>Post Reaction</th>
                    <th>Post Comment</th>
                    <th>Post Picture</th>
                    <th>Post Video</th>
                    <th>Post Slide</th>
                    <th>Post Article</th>
                    <th>Post Document</th>
                    <th>Comment Username</th>
                    <th>Comment Job Title</th>
                    <th>Comment Time</th>
                  </tr>
                </thead>
                <tbody>
                  {% for li in data %}
                  <tr>
                    <td>{{ li.post_username }}</td>
                    <td>{{ li.post_job_title }}</td>
                    <td>{{ li.post_description }}</td>
                    <td>{{ li.post_time }}</td>
                    <td>{{ li.post_reaction }}</td>
                    <td>{{ li.post_comment }}</td>
                    <td>{{ li.post_picture }}</td>
                    <td>{{ li.post_video }}</td>
                    <td>{{ li.post_slide }}</td>
                    <td>{{ li.post_article }}</td>
                    <td>{{ li.post_document }}</td>
                    <td>{{ li.comment_username }}</td>
                    <td>{{ li.comment_job_title }}</td>
                    <td>{{ li.comment_time }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
                <tfoot></tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Eko: NER & POS -->
    <div class="row">
      <div class="col-lg-12">
        <div class="air__utils__heading">
          <h5>Named Entity Recognition (NER)</h5>
        </div>
        <div class="card">
          <div class="card-body">
            <p style="text-align: center;">
              <iframe src="{% static 'external/graphic/ner.html' %}" width="1000" height="200"></iframe>
            </p>
            <p style="text-align: center;">Named Entity Recognition (NER)</p>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div class="air__utils__heading">
          <h5>Part-of-Speech Tagging (POS)</h5>
        </div>
        <div class="card">
          <div class="card-body">
            <p style="text-align: center;">
              <img src="{% static 'external/graphic/pos.svg' %}" width="1000" height="200"></img>
            </p>
            <p style="text-align: center;">Part-of-Speech Tagging (POS)</p>
          </div>
        </div>
      </div>
    </div>
    <!-- end Eko -->

    <!-- Khairul: Wordcloud & Doc Clustering -->
    <div class="card">
      <div class="card-body">
        <div class="air__utils__heading">
          <h5>Document Clustering</h5>
        </div>
        <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.css">
        <div id="lda"></div>
        <script type="text/javascript">
          //var ldavis = ("https://gist.githubusercontent.com/olemi/17d82c722c7d2086b5af1c3fc4b6c6bd/raw/298b1a66292143722021734d83f7bd5d0797d8ac/topic_model_twitter_consulting_bigram_20170323");
          $.getJSON("/static/data/json/ldavis.json", function (data) {
            var ldavis = data;


            function LDAvis_load_lib(url, callback) {
              var s = document.createElement('script');
              s.src = url;
              s.async = true;
              s.onreadystatechange = s.onload = callback;
              s.onerror = function () { console.warn("failed to load library " + url); };
              document.getElementsByTagName("head")[0].appendChild(s);
            }

            if (typeof (LDAvis) !== "undefined") {
              // already loaded: just create the visualization
              !function (LDAvis) {
                new LDAvis("#" + "lda", ldavis);
              }(LDAvis);
            } else if (typeof define === "function" && define.amd) {
              // require.js is available: use it to load d3/LDAvis
              //  require.config({paths: {d3: "https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min"}});
              require(["d3"], function (d3) {
                window.d3 = d3;
                LDAvis_load_lib("https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.js", function () {
                  new LDAvis("#" + "lda", ldavis);
                });
              });
            } else {
              // require.js not available: dynamically load d3 & LDAvis
              LDAvis_load_lib("https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js", function () {
                LDAvis_load_lib("https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.js", function () {
                  new LDAvis("#" + "lda", ldavis);
                })
              });
            }
          })
        </script>
      </div>
    </div>

    <div class="air__utils__heading">
      <h5>Wordcloud</h5>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-lg-6 position-relative">
            <div id="wordcloud"></div>
          </div>
          <div class="col-lg-6">
            <div id="scatter"></div>
          </div>
        </div>
        <!-- Load d3-cloud -->
        <script src="https://d3js.org/d3.v4.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
        <script>
          //WORDSCLOUD
          // set the dimensions and margins of the graph
          var margin = { top: 10, right: 10, bottom: 10, left: 10 },
            width = 450 - margin.left - margin.right,
            height = 450 - margin.top - margin.bottom;

          // append the svg object to the body of the page
          var wc = d3.select("#wordcloud")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

          // Constructs a new cloud layout instance. It run an algorithm to find the position of words that suits your requirements
          // Wordcloud features that are different from one word to the other must be here
          d3.json("/static/data/json/wordcloud.json", function (data) {
            var layout = d3.layout.cloud()
              .size([width, height])
              .words(data.map(function (d) { return { text: d.word, size: d.size, color: d.color }; }))
              .padding(5)        //space between words
              .rotate(function () { return ~~(Math.random() * 2) * 90; })
              .fontSize(function (d) { return d.size; })      // font size of words             
              .on("end", draw);
            layout.start();

            // This function takes the output of 'layout' above and draw the words
            // Wordcloud features that are THE SAME from one word to the other can be here
            function draw(words) {
              // Color scale: give me a specie name, I return a color            
              var color = d3.scaleOrdinal()
                .domain(["navy", "springGreen", "greenYellow", "indigo", "lightGreen", "yellow"])
                .range(["#071A52", "#00FF7F", "#ADFF2F", "#4B0082", "#90EE90", "#FFFF00"])

              wc.append("g")
                .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function (d) { return d.size; })
                .attr("text-anchor", "middle")
                .style("font-family", "Impact")
                //.attr("fill", "#69b3a2")
                .style("fill", function (d) { return color(d.color) })
                .attr("transform", function (d) {
                  return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function (d) { return d.text; });
            }
          })
          //SCATTER versi d3
          // set the dimensions and margins of the graph
          var margin = { top: 10, right: 30, bottom: 30, left: 60 },
            width = 460 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;


          // append the svg object to the body of the page
          var sct = d3.select("#scatter")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

          //Read the data
          d3.json("/static/data/json/scatter.json", function (data) {

            // Add X axis
            var x = d3.scaleLinear()
              .domain([4, 8])
              .range([0, width]);
            sct.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
              .domain([0, 9])
              .range([height, 0]);
            sct.append("g")
              .call(d3.axisLeft(y));

            // Color scale: give me a specie name, I return a color
            var color = d3.scaleOrdinal()
              .domain(["setosa", "versicolor", "virginica"])
              .range(["#440154ff", "#21908dff", "#fde725ff"])

            // Add dots
            sct.append('g')
              .selectAll("dot")
              .data(data)
              .enter()
              .append("circle")
              .attr("cx", function (d) { return x(d.Sepal_Length); })
              .attr("cy", function (d) { return y(d.Petal_Length); })
              .attr("r", 5)
              .style("fill", function (d) { return color(d.Species) })

          })
        </script>
      </div>
      <!-- end Khairul -->

      <!-- Howard: Sentiment Analysis & Sentiment Polarity -->
      <div class="air__layout__content">
        <div class="air__utils__content">
          <div class="air__utils__heading">
            <h5> Sentiment Analysis</h5>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="row">
                <div class="col-lg-12" id="sentiment_analysis">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script src="{% static 'common/d3.min.js' %}"></script>
      <script src="{% static 'common/cloud.js' %}"></script>
      <script>
        var text_string = "Our goal is to get the best version consistently that’s going to bring us closer to winning football matches. That’s what I want from the team. If we do that consistently in every single match, we’re going to be in a good place, but that’s something we haven’t done, consistently give the best version. That’s something we must control and we must do, and I think if we’re able to do that, then the results will be the consequence to that.";

        drawWordCloud(text_string);

        function drawWordCloud(text_string) {
          var common = "poop,i,me,my,myself,we,us,our,ours,ourselves,you,your,yours,yourself,yourselves,he,him,his,himself,she,her,hers,herself,it,its,itself,they,them,their,theirs,themselves,what,which,who,whom,whose,this,that,these,those,am,is,are,was,were,be,been,being,have,has,had,having,do,does,did,doing,will,would,should,can,could,ought,i'm,you're,he's,she's,it's,we're,they're,i've,you've,we've,they've,i'd,you'd,he'd,she'd,we'd,they'd,i'll,you'll,he'll,she'll,we'll,they'll,isn't,aren't,wasn't,weren't,hasn't,haven't,hadn't,doesn't,don't,didn't,won't,wouldn't,shan't,shouldn't,can't,cannot,couldn't,mustn't,let's,that's,who's,what's,here's,there's,when's,where's,why's,how's,a,an,the,and,but,if,or,because,as,until,while,of,at,by,for,with,about,against,between,into,through,during,before,after,above,below,to,from,up,upon,down,in,out,on,off,over,under,again,further,then,once,here,there,when,where,why,how,all,any,both,each,few,more,most,other,some,such,no,nor,not,only,own,same,so,than,too,very,say,says,said,shall";

          var word_count = {};

          var words = text_string.split(/[ '\-\(\)\*":;\[\]|{},.!?]+/);
          if (words.length == 1) {
            word_count[words[0]] = 1;
          } else {
            words.forEach(function (word) {
              var word = word.toLowerCase();
              if (word != "" && common.indexOf(word) == -1 && word.length > 1) {
                if (word_count[word]) {
                  word_count[word]++;
                } else {
                  word_count[word] = 1;
                }
              }
            })
          }

          var svg_location = "#sentiment_analysis";
          var width = $('#sentiment_analysis').width();
          var height = 360;

          var fill = d3.scale.category20();

          var word_entries = d3.entries(word_count);

          var xScale = d3.scale.linear()
            .domain([0, d3.max(word_entries, function (d) {
              return d.value;
            })
            ])
            .range([10, 100]);

          d3.layout.cloud().size([width, height])
            .timeInterval(20)
            .words(word_entries)
            .fontSize(function (d) { return xScale(+d.value); })
            .text(function (d) { return d.key; })
            .rotate(function () { return ~~(Math.random() * 2) * 90; })
            .font("Impact")
            .on("end", draw)
            .start();

          function draw(words) {
            d3.select(svg_location).append("svg")
              .attr("width", width)
              .attr("height", height)
              .append("g")
              .attr("transform", "translate(" + [width >> 1, height >> 1] + ")")
              .selectAll("text")
              .data(words)
              .enter().append("text")
              .style("font-size", function (d) { return xScale(d.value) + "px"; })
              .style("font-family", "Impact")
              .style("fill", "#69b3a2")
              .attr("text-anchor", "middle")
              .attr("transform", function (d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
              })
              .text(function (d) { return d.key; });
          }
          d3.layout.cloud().stop();
        }
      </script>

      <script>
        var text_string = "That the team puts in place what we’ve been working on and the spirit that they have and the energy that they’ve been training with and in games more consistently, because we’ve had some very good patches against both teams in the last two games against Spurs and Chelsea. It’s how we compete in matches to get the wins, which is the most important things. ";

        drawWordCloud(text_string);

        function drawWordCloud(text_string) {
          var common = "poop,i,me,my,myself,we,us,our,ours,ourselves,you,your,yours,yourself,yourselves,he,him,his,himself,she,her,hers,herself,it,its,itself,they,them,their,theirs,themselves,what,which,who,whom,whose,this,that,these,those,am,is,are,was,were,be,been,being,have,has,had,having,do,does,did,doing,will,would,should,can,could,ought,i'm,you're,he's,she's,it's,we're,they're,i've,you've,we've,they've,i'd,you'd,he'd,she'd,we'd,they'd,i'll,you'll,he'll,she'll,we'll,they'll,isn't,aren't,wasn't,weren't,hasn't,haven't,hadn't,doesn't,don't,didn't,won't,wouldn't,shan't,shouldn't,can't,cannot,couldn't,mustn't,let's,that's,who's,what's,here's,there's,when's,where's,why's,how's,a,an,the,and,but,if,or,because,as,until,while,of,at,by,for,with,about,against,between,into,through,during,before,after,above,below,to,from,up,upon,down,in,out,on,off,over,under,again,further,then,once,here,there,when,where,why,how,all,any,both,each,few,more,most,other,some,such,no,nor,not,only,own,same,so,than,too,very,say,says,said,shall";

          var word_count = {};

          var words = text_string.split(/[ '\-\(\)\*":;\[\]|{},.!?]+/);
          if (words.length == 1) {
            word_count[words[0]] = 1;
          } else {
            words.forEach(function (word) {
              var word = word.toLowerCase();
              if (word != "" && common.indexOf(word) == -1 && word.length > 1) {
                if (word_count[word]) {
                  word_count[word]++;
                } else {
                  word_count[word] = 1;
                }
              }
            })
          }

          var svg_location = "#sentiment_analysis";
          var width = $('#sentiment_analysis').width();
          var height = 360;

          var fill = d3.scale.category20();

          var word_entries = d3.entries(word_count);

          var xScale = d3.scale.linear()
            .domain([0, d3.max(word_entries, function (d) {
              return d.value;
            })
            ])
            .range([10, 100]);

          d3.layout.cloud().size([width, height])
            .timeInterval(20)
            .words(word_entries)
            .fontSize(function (d) { return xScale(+d.value); })
            .text(function (d) { return d.key; })
            .rotate(function () { return ~~(Math.random() * 2) * 90; })
            .font("Impact")
            .on("end", draw)
            .start();

          function draw(words) {
            d3.select(svg_location).append("svg")
              .attr("width", width)
              .attr("height", height)
              .append("g")
              .attr("transform", "translate(" + [width >> 1, height >> 1] + ")")
              .selectAll("text")
              .data(words)
              .enter().append("text")
              .style("font-size", function (d) { return xScale(d.value) + "px"; })
              .style("font-family", "Impact")
              .style("fill", "#FF0000")
              .attr("text-anchor", "middle")
              .attr("transform", function (d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
              })
              .text(function (d) { return d.key; });

          }



          d3.layout.cloud().stop();
        }


      </script>

      <div class="air__layout__content">
        <div class="air__utils__content">
          <div class="air__utils__heading">
            <h5>Sentiment Polarity</h5>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="row">
                <div id="my_dataviz">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Load d3.js -->
      <script src="https://d3js.org/d3.v4.js"></script>

      <script>
        // set the dimensions and margins of the graph
        var margin = { top: 10, right: 30, bottom: 30, left: 40 },
          width = 460 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#my_dataviz")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

        // get the data
        d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_doubleHist.csv", function (data) {
          // X axis: scale and draw:
          var x = d3.scaleLinear()
            .domain([-4, 9])     // can use this instead of 1000 to have the max of data: d3.max(data, function(d) { return +d.price })
            .range([0, width]);
          svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

          // set the parameters for the histogram
          var histogram = d3.histogram()
            .value(function (d) { return +d.value; })   // I need to give the vector of value
            .domain(x.domain())  // then the domain of the graphic
            .thresholds(x.ticks(40)); // then the numbers of bins

          // And apply twice this function to data to get the bins.
          var bins1 = histogram(data.filter(function (d) { return d.type === "variable 1" }));
          var bins2 = histogram(data.filter(function (d) { return d.type === "variable 2" }));

          // Y axis: scale and draw:
          var y = d3.scaleLinear()
            .range([height, 0]);
          y.domain([0, d3.max(bins1, function (d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
          svg.append("g")
            .call(d3.axisLeft(y));

          // append the bars for series 1
          svg.selectAll("rect")
            .data(bins1)
            .enter()
            .append("rect")
            .attr("x", 1)
            .attr("transform", function (d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function (d) { return x(d.x1) - x(d.x0) - 1; })
            .attr("height", function (d) { return height - y(d.length); })
            .style("fill", "#3952a3")
            .style("opacity", 0.6)

          // append the bars for series 2
          svg.selectAll("rect2")
            .data(bins2)
            .enter()
            .append("rect")
            .attr("x", 1)
            .attr("transform", function (d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function (d) { return x(d.x1) - x(d.x0) - 1; })
            .attr("height", function (d) { return height - y(d.length); })
            .style("fill", "#a64d19")
            .style("opacity", 0.6)

          // Handmade legend
          svg.append("circle").attr("cx", 300).attr("cy", 30).attr("r", 6).style("fill", "#3952a3")
          svg.append("circle").attr("cx", 300).attr("cy", 60).attr("r", 6).style("fill", "#a64d19")
          svg.append("text").attr("x", 320).attr("y", 30).text("Not Recommended").style("font-size", "15px").attr("alignment-baseline", "middle")
          svg.append("text").attr("x", 320).attr("y", 60).text("Recommended").style("font-size", "15px").attr("alignment-baseline", "middle")
        });
      </script>


      <!-- end Howard -->


    </div>
  </div>
  <script type="text/javascript">

    $(function () {
      $("#example1").DataTable({
        responsive: true,
        // autoWidth: true,
        // scrollX: true,
        // fixedColumns: true,
      });
    })
  </script>
  {% endblock content %}